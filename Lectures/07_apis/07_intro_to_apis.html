<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>ISA 401: Business Intelligence &amp; Data Visualization</title>
    <meta charset="utf-8" />
    <meta name="author" content=" Fadel M. Megahed, PhD    Associate Professor   Department of Information Systems and Analytics   Farmer School of Business  Miami University  Twitter: FadelMegahed  GitHub: fmegahed  Email: fmegahed@miamioh.edu  Office Hours: Automated Scheduler for Virtual Office Hours  " />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/tile-view/tile-view.css" rel="stylesheet" />
    <script src="libs/tile-view/tile-view.js"></script>
    <link href="libs/animate.css/animate.xaringan.css" rel="stylesheet" />
    <link href="libs/tachyons/tachyons.min.css" rel="stylesheet" />
    <script src="libs/xaringanExtra_fit-screen/fit-screen.js"></script>
    <link href="libs/panelset/panelset.css" rel="stylesheet" />
    <script src="libs/panelset/panelset.js"></script>
    <script type="application/json" id="xaringanExtra-editable-docid">{"id":"xfebb9d887184aa7a5c8445b87df5f3f","expires":14}</script>
    <script src="libs/himalaya/himalaya.js"></script>
    <script src="libs/js-cookie/js.cookie.js"></script>
    <link href="libs/editable/editable.css" rel="stylesheet" />
    <script src="libs/editable/editable.js"></script>
    <script src="libs/clipboard/clipboard.min.js"></script>
    <link href="libs/shareon/shareon.min.css" rel="stylesheet" />
    <script src="libs/shareon/shareon.min.js"></script>
    <link href="libs/xaringanExtra-shareagain/shareagain.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-shareagain/shareagain.js"></script>
    <script src="libs/peerjs/peerjs.min.js"></script>
    <script src="libs/tiny.toast/toast.min.js"></script>
    <link href="libs/xaringanExtra-broadcast/broadcast.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-broadcast/broadcast.js"></script>
    <script src="libs/mark.js/mark.min.js"></script>
    <link href="libs/xaringanExtra-search/search.css" rel="stylesheet" />
    <script src="libs/xaringanExtra-search/search.js"></script>
    <script>window.addEventListener('load', function() { window.xeSearch = new RemarkSearch({"position":"bottom-left","caseSensitive":false,"showIcon":false,"autoSearch":true}) })</script>
    <link rel="stylesheet" href="css/fonts.css" type="text/css" />
    <link rel="stylesheet" href="css/my-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# ISA 401: Business Intelligence &amp; Data Visualization
## 07: Connecting to APIs in R
### <br>Fadel M. Megahed, PhD <br><br> Associate Professor <br> Department of Information Systems and Analytics <br> Farmer School of Business<br> Miami University<br><br>Twitter: <a href="www.twitter.com/FadelMegahed/">FadelMegahed</a><br> GitHub: <a href="https://github.com/fmegahed">fmegahed</a><br> Email: <a href="mailto:fmegahed@miamioh.edu">fmegahed@miamioh.edu</a><br> Office Hours: <a href="https://calendly.com/fmegahed">Automated Scheduler for Virtual Office Hours</a><br><br>
### Spring 2022

---








# Quick Refresher from Last Week


✅ Understand when can we scrape data (i.e., `robots.txt`)  

✅ Scrape a webpage Using <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C3142D;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg>  

✅ Utilize loops or `purr::map` to download data from multiple webpages.  


---

# Learning Objectives for Today's Class

- Describe what is an API 

- Download data using APIs


---
class: inverse, center, middle

# What is an API?

---

# What is an API? [1]

- An **API** is an acronym for application programming interface. 

- It is a **popular** approach to interact with an application/service or data since it:  
  * Defines a set of functionalities independent of implementation (i.e., it only exposes information that a programmer might find useful and keep those parts consistent even if the implementation changes later)
  * Provides some level of privacy/control over one's internal data and the rate at which it can be accessed. 

---

# What is an API? [2]

&lt;center&gt;

&lt;iframe width="896" height="504" src="https://www.youtube.com/embed/s7wmiS2mSXY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen&gt;&lt;/iframe&gt;

&lt;/center&gt;


---

# What is an API?  [3]

.center[**Scenario:** Alone, you went into a warehouse and are trying to retrieve 3 screwdrivers, a toolbox, and 15 phillips screws. But you do not know, where those things are in the warehouse.]

&lt;div class="figure" style="text-align: center"&gt;
&lt;img src="https://miro.medium.com/max/1400/1*oklkpcOX4lpttIAsd2gwXg.jpeg" alt="The API is the set of instructions provided by the warehouse manager on where/how to retrieve this information without touching/accessing other things in there." width="60%" /&gt;
&lt;p class="caption"&gt;The API is the set of instructions provided by the warehouse manager on where/how to retrieve this information without touching/accessing other things in there.&lt;/p&gt;
&lt;/div&gt;

.footnote[
&lt;html&gt;
&lt;hr&gt;
&lt;/html&gt;
**Source:** [Matt Z. (2018). What is an API? (explanation with cartoon picture so a 5 year old could understand it)](https://medium.com/@xiang_zhou/what-is-an-api-explanation-with-cartoon-picture-so-a-5-year-old-could-understand-it-6c6c42b75be4)
]

---
class: inverse, center, middle

# Accessing APIs in R

---

# The 3 Step Process

Before you dive into the API documentation, you **should first check if there is a R (or Python if you are familiar)** package/library that serves as a wrapper for that API.

1. **Find** the **API's documentation** and find information about the following:  
  A. Does the API require an **authentication key**?   
  B. What are the API's **base URL** and **query parameters**?  
  C. How does the request URL look like?  
  
2.Craft your **request**. My recommendations are to:  
  A. First, start with a simple request.  
  B. Test that request in your browser and see what results you get.   
  
3. Construct that request in <svg aria-hidden="true" role="img" viewBox="0 0 581 512" style="height:1em;width:1.13em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C3142D;overflow:visible;position:relative;"><path d="M581 226.6C581 119.1 450.9 32 290.5 32S0 119.1 0 226.6C0 322.4 103.3 402 239.4 418.1V480h99.1v-61.5c24.3-2.7 47.6-7.4 69.4-13.9L448 480h112l-67.4-113.7c54.5-35.4 88.4-84.9 88.4-139.7zm-466.8 14.5c0-73.5 98.9-133 220.8-133s211.9 40.7 211.9 133c0 50.1-26.5 85-70.3 106.4-2.4-1.6-4.7-2.9-6.4-3.7-10.2-5.2-27.8-10.5-27.8-10.5s86.6-6.4 86.6-92.7-90.6-87.9-90.6-87.9h-199V361c-74.1-21.5-125.2-67.1-125.2-119.9zm225.1 38.3v-55.6c57.8 0 87.8-6.8 87.8 27.3 0 36.5-38.2 28.3-87.8 28.3zm-.9 72.5H365c10.8 0 18.9 11.7 24 19.2-16.1 1.9-33 2.8-50.6 2.9v-22.1z"/></svg> by **either**:
  A. If the generated content seems to be a `JSON` file/webpage, you can capitalize on the 
    reading the content from `jsonlite::fromJSON()`; **OR**  
  B. By passing the `base url` inside the `httr::GET()` and parsing the results with `httr::content()`. 


---

# Demo 1: `tidycensus` vs Census API

.panelset[

.panel[.panel-name[Motivation]

.small[
In socio-economic analysis, we are often interested in examining explanatory population-level variables. For the U.S., the decennial (once every 10 ten years) Census, and the  1-year and 5-year American Community Surveys are often the gold-standard for such data. 

Luckily, the [tidycensus](https://walker-data.com/tidycensus/index.html) is an R package that allows users to interface with a select number of the US Census Bureau’s data APIs and return tidyverse-ready data frames.
]

]

.panel[.panel-name[Learning Objectives]
&gt; In this demo, we will:
&gt; - Set up an API key for the Census API
&gt; - Use the `tidycensus` package to obtain the total population for Butler and Warren Counties in Ohio from &lt;https://api.census.gov/data/2020/dec/pl/variables.html&gt;
&gt; - Extract the same data by capitalizing on the API itself (i.e., without the tidycensus package)

]

.panel[.panel-name[`tidycensus` Results]

&gt; In class, we will live code and capitalize on the `tidycensus` package to get the  
total population for Butler and Warren Counties in Ohio from &lt;https://api.census.gov/data/2020/dec/pl/variables.html&gt; 


```
## # A tibble: 2 x 4
##   GEOID NAME                variable  value
##   &lt;chr&gt; &lt;chr&gt;               &lt;chr&gt;     &lt;dbl&gt;
## 1 39017 Butler County, Ohio P1_001N  390357
## 2 39165 Warren County, Ohio P1_001N  242337
```

]

.panel[.panel-name[Direct Results]

&gt; In class, we will live code and capitalize on the `tidycensus` package to get the  
total population for Butler and Warren Counties in Ohio from &lt;https://api.census.gov/data/2020/dec/pl/variables.html&gt; 


```
## # A tibble: 2 x 3
##   P1_001N state county
##   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; 
## 1 390357  39    017   
## 2 242337  39    165
```

]

]



---

# Demo 2: Accuweather API

.panelset[

.panel[.panel-name[Demo Description]

&gt; - Go to &lt;https://developer.accuweather.com/&gt; and create an account. 
&gt; - Add your first app (from the `MY APPS` tab) and copy the generated API key. 
&gt; - Then using the API Reference Tab <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C3142D;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> Locations API <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C3142D;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> City Search <svg aria-hidden="true" role="img" viewBox="0 0 448 512" style="height:1em;width:0.88em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:#C3142D;overflow:visible;position:relative;"><path d="M190.5 66.9l22.2-22.2c9.4-9.4 24.6-9.4 33.9 0L441 239c9.4 9.4 9.4 24.6 0 33.9L246.6 467.3c-9.4 9.4-24.6 9.4-33.9 0l-22.2-22.2c-9.5-9.5-9.3-25 .4-34.3L311.4 296H24c-13.3 0-24-10.7-24-24v-32c0-13.3 10.7-24 24-24h287.4L190.9 101.2c-9.8-9.3-10-24.8-.4-34.3z"/></svg> find the location key for `Oxford, Ohio` 
&gt; - Use this information in the `Forecast API` to obtain the `5 Day Forecasts` for `Oxford Ohio`. 

]


.panel[.panel-name[Code and Results]


```
## List of 2
##  $ Headline      :List of 9
##   ..$ EffectiveDate     : chr "2022-02-16T19:00:00-05:00"
##   ..$ EffectiveEpochDate: int 1645056000
##   ..$ Severity          : int 3
##   ..$ Text              : chr "Rain from Wednesday evening until Thursday evening, when it will change to snow and accumulate a coating to an inch"
##   ..$ Category          : chr "snow"
##   ..$ EndDate           : chr "2022-02-18T01:00:00-05:00"
##   ..$ EndEpochDate      : int 1645164000
##   ..$ MobileLink        : chr "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?lang=en-us"
##   ..$ Link              : chr "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?lang=en-us"
##  $ DailyForecasts:'data.frame':	5 obs. of  8 variables:
##   ..$ Date       : chr [1:5] "2022-02-13T07:00:00-05:00" "2022-02-14T07:00:00-05:00" "2022-02-15T07:00:00-05:00" "2022-02-16T07:00:00-05:00" ...
##   ..$ EpochDate  : int [1:5] 1644753600 1644840000 1644926400 1645012800 1645099200
##   ..$ Temperature:'data.frame':	5 obs. of  2 variables:
##   .. ..$ Minimum:'data.frame':	5 obs. of  3 variables:
##   .. ..$ Maximum:'data.frame':	5 obs. of  3 variables:
##   ..$ Day        :'data.frame':	5 obs. of  5 variables:
##   .. ..$ Icon                  : int [1:5] 19 3 3 6 18
##   .. ..$ IconPhrase            : chr [1:5] "Flurries" "Partly sunny" "Partly sunny" "Mostly cloudy" ...
##   .. ..$ HasPrecipitation      : logi [1:5] TRUE FALSE FALSE FALSE TRUE
##   .. ..$ PrecipitationType     : chr [1:5] "Snow" NA NA NA ...
##   .. ..$ PrecipitationIntensity: chr [1:5] "Light" NA NA NA ...
##   ..$ Night      :'data.frame':	5 obs. of  5 variables:
##   .. ..$ Icon                  : int [1:5] 31 33 35 18 22
##   .. ..$ IconPhrase            : chr [1:5] "Cold" "Clear" "Partly cloudy" "Rain" ...
##   .. ..$ HasPrecipitation      : logi [1:5] FALSE FALSE FALSE TRUE TRUE
##   .. ..$ PrecipitationType     : chr [1:5] NA NA NA "Rain" ...
##   .. ..$ PrecipitationIntensity: chr [1:5] NA NA NA "Light" ...
##   ..$ Sources    :List of 5
##   .. ..$ : chr "AccuWeather"
##   .. ..$ : chr "AccuWeather"
##   .. ..$ : chr "AccuWeather"
##   .. ..$ : chr "AccuWeather"
##   .. ..$ : chr "AccuWeather"
##   ..$ MobileLink : chr [1:5] "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?day=1&amp;lang=en-us" "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?day=2&amp;lang=en-us" "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?day=3&amp;lang=en-us" "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?day=4&amp;lang=en-us" ...
##   ..$ Link       : chr [1:5] "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?day=1&amp;lang=en-us" "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?day=2&amp;lang=en-us" "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?day=3&amp;lang=en-us" "http://www.accuweather.com/en/us/oxford-oh/45056/daily-weather-forecast/340019?day=4&amp;lang=en-us" ...
```

]



]


---

# Demo 3: The CryptoCompare API

.panelset[

.panel[.panel-name[Demo Description]

.small[
- Create a Personal (Free) account at [CryptoCompare.com](https://min-api.cryptocompare.com/pricing)   
- Click on create your free key to create your API key and copy the key.  
- Go to the [documentation](https://min-api.cryptocompare.com/documentation), and test their sample call by executing the call after you have pasted your API key in the call.  
  - The executed call returns the price of BTC (Bitcoin) in USD, JPY and EUR. 
- Now click on the Historical Data Tab on the left  
  - Click on Daily Pair OHLCV and Execute the Sample Call for BTC  
  - This returns 10 days worth of OHLCV for BTC in USD.  
- Let us obtain the price for $SHIB over the past 100 days.
]

]

.panel[.panel-name[Code and Results]


```
##           time      high       low      open     close
## 96  2022-02-08 3.500e-05 2.941e-05 3.258e-05 3.100e-05
## 97  2022-02-09 3.409e-05 3.044e-05 3.100e-05 3.298e-05
## 98  2022-02-10 3.373e-05 3.053e-05 3.298e-05 3.085e-05
## 99  2022-02-11 3.239e-05 2.789e-05 3.085e-05 2.871e-05
## 100 2022-02-12 2.985e-05 2.747e-05 2.871e-05 2.915e-05
## 101 2022-02-13 3.217e-05 2.839e-05 2.915e-05 3.048e-05
```

]

]



---
class: inverse, center, middle

# Recap

---

# Summary of Main Points

By now, you should be able to do the following:

- Describe what is an API 

- Download data using APIs


---

# Supplementary Reading on Accessing APIs


* [Getting Started with httr](https://cran.r-project.org/web/packages/httr/vignettes/quickstart.html)  
* [Managing secrets](https://httr.r-lib.org/articles/secrets.html)  




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
