---
title: "ISA 401: Business Intelligence & Data Visualization"
subtitle: "03: Importing and Exporting Data"
author: '<br>Fadel M. Megahed, PhD <br><br> Endres Associate Professor <br> Farmer School of Business<br> Miami University<br><br> [`r icons::icon_style(icons::fontawesome("twitter"), fill = "white")` @FadelMegahed](https://twitter.com/FadelMegahed) <br> [`r icons::icon_style(icons::fontawesome("github"), fill = "white")` fmegahed](https://github.com/fmegahed/) <br> [`r icons::icon_style(icons::fontawesome("paper-plane", style = "solid"), fill = "white")` fmegahed@miamioh.edu](mailto:fmegahed@miamioh.edu)<br> [`r icons::icon_style(icons::fontawesome("question"), fill = "white")` Automated Scheduler for Office Hours](https://calendly.com/fmegahed)<br><br>'
date: "Fall 2023"
output:
  xaringan::moon_reader:
    self_contained: true
    css: [default, "../../style_files/fonts.css", "../../style_files/my-theme.css"]
    lib_dir: libs
    nature:
      highlightStyle: magula
      highlightLines: true
      highlightLanguage: ["r"]
      countIncrementalSlides: false
      ratio: "16:9"
header-includes:  
  - "../../style_files/header.html"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE,
                      echo = TRUE,
                      warning = FALSE,
                      message = FALSE,
                      progress = FALSE, 
                      verbose = FALSE,
                      dev = 'png',
                      fig.height = 3,
                      dpi = 300,
                      fig.align = 'center')

options(htmltools.dir.version = FALSE)

miamired = '#C3142D'

if(require(pacman)==FALSE) install.packages("pacman")
if(require(devtools)==FALSE) install.packages("devtools")
if(require(countdown)==FALSE) devtools::install_github("gadenbuie/countdown")
if(require(xaringanExtra)==FALSE) devtools::install_github("gadenbuie/xaringanExtra")
if(require(urbnmapr)==FALSE) devtools::install_github('UrbanInstitute/urbnmapr')
if(require(memer)==FALSE) devtools::install_github("sctyner/memer")

pacman::p_load(tidyverse, magrittr, lubridate, janitor, # data analysis pkgs
               readxl, vroom, haven,
               memer, # memes
               scales, # for the comma function
               gifski, av, # for animations
               fontawesome, RefManageR, xaringanExtra, countdown) # for slides

BibOptions(check.entries = FALSE, bib.style = "authoryear", 
           style = "markdown", dashed = TRUE)

bib = ReadBib("refs.bib") 
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
if(require(xaringanthemer) == FALSE) install.packages("xaringanthemer")
library(xaringanthemer)

style_mono_accent(base_color = "#84d6d3",
                  base_font_size = "20px")

xaringanExtra::use_xaringan_extra(c("tile_view", "animate_css", "tachyons", "panelset", "broadcast", "share_again", "search", "fit_screen", "editable", 
                                    "clipable"))

```


# Quick Refresher from Last Class

`r emo::ji("check")`  Describe how and why we use scripted languages in this course.  

`r emo::ji("check")`  Utilize the project workflow in RStudio (we will try to use that as an IDE for `r fa(name = "r-project", fill = miamired)` and `r fa(name = "python", fill = miamired)`).  

`r emo::ji("check")` Understand the syntax, data structures and functions in both `r fa(name = "r-project", fill = miamired)` and `r fa(name = "python", fill = miamired)`. 

`r emo::ji("check")`  Understand the potential impact of LLMs on businesses and explore how they can be leveraged in the context of this class.   


---

# Learning Objectives for Today's Class

- Subset data in `r fontawesome::fa(name = 'r-project', fill = miamired)` and `r fontawesome::fa(name = 'python', fill = miamired)`.  

- Read text-files, binary files (e.g., Excel, SAS, SPSS, Stata, etc), json files, etc.  

- Export data from `r fontawesome::fa(name = 'r-project', fill = miamired)` and `r fontawesome::fa(name = 'python', fill = miamired)`.


---
class: inverse, center, middle

# Subsetting Data


---

# Recall: Atomic Vectors (1D)

.center[**Atomic vectors** are 1D data structures in R, where all elements **must have the same type.**]

.pull-left[Since they are **1D data structures**, they are subsetted using `[element_no(s)]`.   

```{r x_vec_print}
x_vec = rnorm(3)
x_vec

x_vec[2]

x_vec[c(1,3)]
```

]


.pull-right[<img src="https://d33wubrfki0l68.cloudfront.net/eb6730b841e32292d9ff36b33a590e24b6221f43/57192/diagrams/vectors/summary-tree-atomic.png" width="60%"> <br><br> <img src="https://d33wubrfki0l68.cloudfront.net/8a3d360c80da1186b1373a0ff0ddf7803b96e20d/254c6/diagrams/vectors/atomic.png" width="80%">]  

.footnote[
<html>
<hr>
</html>
**Sources:** Images are from [Hadley Wickham's Advanced R Book, Chapter 3 on Vectors](https://adv-r.hadley.nz/vectors-chap.html).
]


---

# Recall: Lists 

```{r lst-data}
lst <- list( 1:5, "a", c(TRUE, FALSE, TRUE), c(2.3, 5.9) )
```

.pull-left[
Subset by `[]`
```{r lst-sub}
lst[4]
```
]
.pull-right[
Subset by `[[]]`
```{r lst-sub2}
lst[[4]]
```
]

.center[<img src="../../figures/pepper.png" width="45%">]

.footnote[
<html>
<hr>
</html>
**Sources:** Image is from [Hadley Wickham's Tweet on Indexing lists in R](https://twitter.com/hadleywickham/status/643381054758363136?lang=en).
]


---

# Recall: Matrices (2D)

A matrix is a **2D data structure** made of **one/homogeneous data type.**


.pull-left[
### A 2 $\times$ 2 numeric matrix
```{r num_matrix1}
x_mat = matrix( sample(1:10, size = 4), nrow = 2, ncol = 2 ) 
```

```{r num_matrix2, results='hold'}
x_mat # printing it nicely
print('-----------------')
x_mat[1, 2] # subsetting #<< 
```


]


.pull-right[
### A 3 $\times$ 4 character matrix
```{r char_matrix1}
x_char = matrix( sample(letters, size = 12), nrow = 3, ncol =4 )
x_char
```



```{r char_matrix2}
x_char[1:2, 2:3] # subsetting #<< 
```
]


---

# Tibbles 

.pull-left[
```{r tibbles}
library(tibble)

dept = c('ACC', 'ECO', 'FIN', 'ISA', 'MGMT')
nfaculty = c(18L, 19L, 14L, 25L, 22L)

fsb_tbl <- tibble(
  department = dept, 
  count = nfaculty, 
  percentage = count / sum(count))
fsb_tbl
```
]

.pull-right[
.center[<img src="../../figures/legos-jbryan-structures.png" width="92%">]
]

.left[
.footnote[
<html>
<hr>
</html>
**Source:** The image is from the excellent [lego-rstats GitHub Repository by Jenny Bryan](https://github.com/jennybc/lego-rstats#readme)
]
]


---

# Subsetting Tibbles

.left-column[
## **to <br> 1d**
]
.right-column[
* with `[[]]` or `$`
```{r subset-vct}
fsb_tbl[["count"]] # column name

fsb_tbl[[2]] # column position

fsb_tbl$count # column name

```
]

.footnote[
<html>
<hr>
</html> 

**Source:** Slide is based on [Earo Wang's STAT 220 Slides](https://stats220.earo.me/02-import-export.html#19).
]


---

# Subsetting Tibbles

.left-column[
## **by <br> columns**
]
.right-column[
* with `[]` or `[, col]`

.pull-left[
```{r subset-col1}
fsb_tbl["count"]
```
]
.pull-right[
```{r subset-col2}
fsb_tbl[2] # for data.frames -> fsb_tbl[, 2]
```
]
]

.footnote[
<html>
<hr>
</html> 

**Source:** Slide is based on [Earo Wang's STAT 220 Slides](https://stats220.earo.me/02-import-export.html#20).
]


---

# Subsetting Tibbles

.left-column[
## **by rows**
]
.right-column[
* with `[row, ]`

.pull-left[
```{r subset-row1}
fsb_tbl[c(1, 3), ]
```
]
.pull-right[
```{r subset-row2}
fsb_tbl[-c(2, 4), ]
```
]
]

.footnote[
<html>
<hr>
</html> 

**Source:** Slide is based on [Earo Wang's STAT 220 Slides](https://stats220.earo.me/02-import-export.html#21).
]


---

# Subsetting Tibbles

.left-column[

## **by <br> rows <br> and <br> columns**
]
.right-column[
* with `[row, col]`

```{r subset-cr, results = "hold", eval = 1}
fsb_tbl[1:3, 2:3]
## fsb_tbl[-4, 2:3] # same as above
## fsb_tbl[1:3, c("count". "percentage")] # same result
## fsb_tbl[c(rep(TRUE, 3), FALSE), 2:3] # same as above
```
]

.footnote[
<html>
<hr>
</html> 

**Source:** Slide is based on [Earo Wang's STAT 220 Slides](https://stats220.earo.me/02-import-export.html#22).
]


---

# Subsetting Tibbles

* Use `[[` to extract 1d vectors from 2d tibbles
* Use `[` to subset tibbles to a new tibble
  + numbers (positive/negative) as indices
  + characters (column names) as indices
  + logicals as indices

```{r eval = FALSE}
fsb_tbl[["count"]] # will produce 1-D vector
fsb_tbl$count # will produce 1D vector

# Resulting in tibbles
fsb_tbl[, 2]
fsb_tbl[1:3, 2:3]
```

.footnote[
<html>
<hr>
</html> 

**Source:** Slide is based on [Earo Wang's STAT 220 Slides](https://stats220.earo.me/02-import-export.html#23).
]


---

# Translating `r fontawesome::fa("r-project", fill = miamired)` Data Structures to `r fontawesome::fa("python", fill = miamired)`

.font90[
<html>
<center>
<table border="1" style="font-size: 0.8em;">
  <tr>
    <th>R Data Structure</th>
    <th>Description</th>
    <th>R Subsetting<br>(Multiple Methods)</th>
    <th>Python Equivalent</th>
    <th>Python Subsetting<br>(Multiple Methods)</th>
  </tr>
  <tr>
    <td>Vector</td>
    <td>1D array, single type</td>
    <td>vector[index]<br>vector[c(1,2)]<br>vector[-1]</td>
    <td>List (with single type)<br>or NumPy array</td>
    <td>list[-1]<br>list[1:3]<br>array[1:3]</td>
  </tr>
  <tr>
    <td>Matrix</td>
    <td>2D array, single type</td>
    <td>matrix[row, col]<br>matrix[1,]<br>matrix[,1]</td>
    <td>2D List (with single type)<br>or 2D NumPy array</td>
    <td>list[row][col]<br>array[row, col]<br>array[row,:]<br>array[:,col]</td>
  </tr>
  <tr>
    <td>Data Frame</td>
    <td>2D table,<br>multiple types</td>
    <td>df[row, col]<br>df[1,]<br>df[, "col"]<br>df$col</td>
    <td>Pandas DataFrame</td>
    <td>df.loc[row, col]<br>df.iloc[row, col]</td>
  </tr>
  <tr>
    <td>List</td>
    <td>Ordered collection,<br>multiple types</td>
    <td>list[[index]]<br>list$element_name<br>list[[1]][1]</td>
    <td>List</td>
    <td>list[index]<br>list[index][subindex]</td>
  </tr>
  <tr>
    <td>Dictionary</td>
    <td>Key-value pairs</td>
    <td>list$element_name</td>
    <td>Dictionary</td>
    <td>dict[key]<br>dict.get(key)</td>
  </tr>
</table>

</center>
</html>
]

.footnote[
<html>
<hr>
</html>

**Note:** Indexing starts at **0** in `r fontawesome::fa("python", fill = miamired)` and at **1** in `r fontawesome::fa("r-project", fill = miamired)`.
]



---

class: inverse middle

# Data import `r emo::ji('arrow_down')`

---

.left-column[
.center[<img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/readr.png" width="60%">]
]
.right-column[
# Reading Plain-Text Rectangular `r fa('file')`
## .small[(a.k.a. flat or spreadsheet-like files)]
* delimited text files with `read_delim()`
  + `.csv`: comma separated values with `read_csv()`
  + `.tsv`: tab separated values `read_tsv()`   
    - In `r fontawesome::fa("python", fill = miamired)`, you can either use `pandas.read_table(filepath)` or `pd.read_csv(fpath, sep='\t')`.

<hr>
]





---

# Some Details on Reading CSV Data Files

## `read_csv()` arguments with [`?read_csv()`](https://readr.tidyverse.org/reference/read_delim.html)

.left-column[
.center[<img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/readr.png" width="60%">]
]
.right-column[
```{r read_csv, eval = F}
read_csv(
  file,
  col_names = TRUE,
  col_types = NULL,
  locale = default_locale(),
  na = c("", "NA"),
  quoted_na = TRUE,
  quote = "\"",
  comment = "",
  trim_ws = TRUE,
  skip = 0,
  n_max = Inf,
  guess_max = min(1000, n_max),
  progress = show_progress(),
  skip_empty_rows = TRUE
)
```
]

???

* w/o using arguments, readr makes smart guesses, which means take a little longer
* more specific, speed up the reading



---


# Demo: Reading CSV Data `r fa('file')` in `r fa('r-project')` and `r fa('python')`

In this hands-on demo, you will learn how to:

- Import CSV files into your environment based on:

  * files that are located on your `r fa('desktop')`, see **Canvas** for downloading an example CSV 
  
  * files that are hosted on the web.  
      + **Data in Webpages `r fa('sitemap')`:** we will cover the following examples in class:   
          - **WH Visitors Log**: <https://www.whitehouse.gov/disclosures/visitor-logs/>    
          - **FRED Data:** e.g., [Unempolyment Rate (UNRATE)](https://fred.stlouisfed.org/series/UNRATE)  
      + **GitHub** `r fa('github')` Repositories, e.g.,
          - [NYT COVID-19 Repo](https://github.com/nytimes/covid-19-data/blob/master/us-states.csv) - by state COVID-19 data 
          - [Women's Rights Around the World](https://github.com/glosophy/women-data) - focusing on  `WomenTotal.csv` 



```{r demo_r, include=FALSE, eval=FALSE}
library(tidyverse)
library(readxl)

# reading csv (locally)
# --------------------
# Talk about the project, placing the file in a specific location and reading the data

burrow_df_r = readr::read_csv(file = 'data/burrow_career_stats.csv', skip = 1)
dplyr::glimpse( burrow_df_r )


# reading csvs that are located on the web
# ----------------------------------------
wh_df = readr::read_csv('https://www.whitehouse.gov/wp-content/uploads/2022/04/2021_WAVES-ACCESS-RECORDS.csv')

fred_df = readr::read_csv('https://fred.stlouisfed.org/graph/fredgraph.csv?bgcolor=%23e1e9f0&chart_type=line&drp=0&fo=open%20sans&graph_bgcolor=%23ffffff&height=450&mode=fred&recession_bars=on&txtcolor=%23444444&ts=12&tts=12&width=1318&nt=0&thu=0&trc=0&show_legend=yes&show_axis_titles=yes&show_tooltip=yes&id=UNRATE&scale=left&cosd=1948-01-01&coed=2023-08-01&line_color=%234572a7&link_values=false&line_style=solid&mark_type=none&mw=3&lw=2&ost=-99999&oet=99999&mma=0&fml=a&fq=Monthly&fam=avg&fgst=lin&fgsnd=2020-02-01&line_index=1&transformation=lin&vintage_date=2023-09-04&revision_date=2023-09-04&nd=1948-01-01')

covid_df_r = readr::read_csv('https://github.com/nytimes/covid-19-data/raw/master/us-states.csv')


ai_df = readxl::read_excel('data/AIAAIC Repository.xlsx', sheet= 'Repository', skip=1)
ai_df = janitor::remove_empty(ai_df, which = 'cols')
ai_df = ai_df[2:1087,  1:35] 
```


```{python demo_py, include=FALSE, eval=FALSE}
import pandas as pd
from os import getcwd

getcwd()

# reading csv (locally)
# --------------------
# Talk about the project, placing the file in a specific location and reading the data

burrow_df_py = pd.read_csv('./data/burrow_career_stats.csv', header =1)
burrow_df_py.describe()


# reading csvs that are located on the web
# ----------------------------------------
wh_df_py = pd.read_csv('https://www.whitehouse.gov/wp-content/uploads/2022/04/2021_WAVES-ACCESS-RECORDS.csv')

fred_df_py = pd.read_csv('https://fred.stlouisfed.org/graph/fredgraph.csv?bgcolor=%23e1e9f0&chart_type=line&drp=0&fo=open%20sans&graph_bgcolor=%23ffffff&height=450&mode=fred&recession_bars=on&txtcolor=%23444444&ts=12&tts=12&width=1318&nt=0&thu=0&trc=0&show_legend=yes&show_axis_titles=yes&show_tooltip=yes&id=UNRATE&scale=left&cosd=1948-01-01&coed=2023-08-01&line_color=%234572a7&link_values=false&line_style=solid&mark_type=none&mw=3&lw=2&ost=-99999&oet=99999&mma=0&fml=a&fq=Monthly&fam=avg&fgst=lin&fgsnd=2020-02-01&line_index=1&transformation=lin&vintage_date=2023-09-04&revision_date=2023-09-04&nd=1948-01-01')

covid_df_py = pd.read_csv('https://github.com/nytimes/covid-19-data/raw/master/us-states.csv')


ai_df_py = pd.read_excel('data/AIAAIC Repository.xlsx', sheet_name= 1, header =1, skiprows=[2])
ai_df_py = ai_df_py.dropna(axis = 1, how = 'all')
ai_df_py.head()

```


---


.left-column[
.center[<img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/readxl.png" width="60%">]
]
.right-column[
# Reading Proprietary Binary Files

**Microsoft Excel `r fa("file-excel", fill = "green")`** (with extensions `.xls`for MSFT Excel 2003 and earlier **OR**  `.xlsx` for MSFT Excel 2007 and later)


### Non-Graded Class Activity

`r countdown(minutes = 5, seconds = 0, top = 0, font_size = "2em")`

.panelset[

.panel[.panel-name[Activity]

.small[
- Download [AIAAIC Repository.xlsx](https://miamioh.instructure.com/courses/202961/files/29007028?module_item_id=4707257)  

- Store the data in an appropriate location on your computer (e.g., within the data folder for ISA 401)

- Use the `read_excel()` from the `readxl` package in `r fa('r-project')` and from `pandas` in `r fa('python')` to read the data.

- Report the number of observations, variables and the class of each variable from the data.  
]
]


.panel[.panel-name[Your Solution]

.small[

> _Over the next 5 minutes, use an R/Python script file to answer the questions from the activity and record your answers below_

.can-edit.key-activity1[
Number of observations and variables: ...... and ......  

The class of each variable ......

] 
]
]

.panel[.panel-name[My Solution]

**Please refer to our discussion in class**

]


]

]



???

* contrasting to plain-text, binary files have to be opened by a certain app

---

.left-column[
.center[<img src="https://raw.githubusercontent.com/rstudio/hex-stickers/master/PNG/haven.png" width="60%">]
]
.right-column[
# Reading Proprietary Binary Files

Several functions from the `r fa('r-project', fill = miamired)` [haven](https://haven.tidyverse.org/) `r fa("box", fill = "gold")` can be used to read and write formats used by other statistical packages. Example functions include:

- SAS
  + `.sas7bdat` with `read_sas()` | In `r fa('python', fill = miamired)`, [`pd.read_sas()`](https://pandas.pydata.org/docs/reference/api/pandas.read_sas.html)
  
- Stata
  + `.dta` with `read_dta()` | In `r fa('python', fill = miamired)`, [`pd.read_stata()`](https://pandas.pydata.org/docs/reference/api/pandas.read_stata.html)
  
- SPSS
  + `.sav` with `read_sav()`  In `r fa('python', fill = miamired)`, [`pd.read_spsss()`](https://pandas.pydata.org/docs/reference/api/pandas.read_spss.html)
  

**Please refer to the help files for each of those packages for more details.**

]


---

# JSON Files

> _JSON (JavaScript Object Notation) is an open standard file format and data interchange format that uses **human-readable** text to store and transmit data **objects** consisting of **attributeâ€“value pairs** and **arrays**... It is a common data format with diverse uses ... including that of web applications with servers._ --- [Wikipedia's Definition of JSON](https://en.wikipedia.org/wiki/JSON)

* **object:** `{}`
* **array:** `[]`
* **value:** string/character, number, object, array, logical, `null`


---

# JSON Files

.pull-left[
### JSON
```json
{
  "firstName": "Mickey",
  "lastName": "Mouse",
  "address": {
    "city": "Mousetown",
    "postalCode": 10000
  }
  "logical": [true, false]
}
```
]
.pull-right[
### R list
```r
list(
  firstName = "Mickey",
  lastName = "Mouse",
  address = list(
    city = "Mousetown",
    postalCode = 10000
  ),
  logical = c(TRUE, FALSE)
)
```
]


---

# Demo

We will use the `r fa('r-project', fill = miamired)` [jsonlite](https://cran.r-project.org/web/packages/jsonlite/index.html) `r fa('box', fill = 'gold')` to read an example from one of the [awesome-json-datasets](https://github.com/jdorfman/awesome-json-datasets). In `r fa('python', fill = miamired)`, we will use [`pandas.read_json()`](https://pandas.pydata.org/docs/reference/api/pandas.read_json.html)

Please note the following from the `r fa('r-project', fill = miamired)` demo:  

- **Setting up the package**, which should be a one-time event if you are using the same computer.  

- **Which function** are we using from the package to read the json data? 

- What is the **type of object returned** by the function?

- How are we **converting the object to a tibble?**  

Please note the following from the `r fa('python', fill = miamired)` demo:    
- How the `pd.read_()` has a consistent approach to data importing?



---
class: inverse, center, middle

# Data export `r emo::ji('arrow_up')`

---

# From Read to Write

`r fa('r-project', fill = miamired)` `read_*()` to `write_*()`

**Do these `r fa('r-project', fill = miamired)` functions come from the same package?**


```{r write-stuff, eval = FALSE}
write_csv(example_tbl, file = "example.csv")
write_sas(example_tbl, path = "example.sas7bdat")
write_json(example_tbl, path = "example.json")
```

`r fa('python', fill = miamired)` `read_*()` to `DataFrame.to_*()`

**Do these `r fa('python', fill = miamired)` functions come from the same package?**


```{python to-stuff, eval = FALSE}
import pandas as pd

covid_df_py = pd.read_csv('https://github.com/nytimes/covid-19-data/raw/master/us-states.csv')

covid_df_py.to_excel('./data/covid_example.xlsx')
```


---
class: inverse, center, middle

# Recap

---

# Summary of Main Points

By now, you should be able to do the following:  

- Subset data in `r fontawesome::fa(name = 'r-project', fill = miamired)` and `r fontawesome::fa(name = 'python', fill = miamired)`.  

- Read text-files, binary files (e.g., Excel, SAS, SPSS, Stata, etc), json files, etc.  

- Export data from `r fontawesome::fa(name = 'r-project', fill = miamired)` and `r fontawesome::fa(name = 'python', fill = miamired)`.



---

# Things to Do to Prepare for Our Next Class

- Go over your notes and complete [Assignment 03](https://miamioh.instructure.com/courses/202961/quizzes/582510) on Canvas.  

- **Before attempting the assignment, you are encouraged to:**  
  * Go over this slide deck as well as the [slide deck from last class](https://fmegahed.github.io/isa401/fall2023/class02/02_llms_r_python.html)  
  * Read the supplementary reading highlighted in [Class 01 Slide 39](https://fmegahed.github.io/isa401/fall2023/class01/01_Introduction.html?panelset3=activity4&panelset4=activity5&panelset5=activity6#39)
  
- **While attempting the assignment, you are encouraged to:**  
  * Google (`r fontawesome::fa(name = 'google', fill = miamired)`) any `r fontawesome::fa(name = 'r-project', fill = miamired)` or `r fontawesome::fa(name = 'python', fill = miamired)` that you need.  
  * Consult the [readr cheatsheet](https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-import.pdf) and the [pandas cheatsheet](https://pandas.pydata.org/Pandas_Cheat_Sheet.pdf) to quickly reference common use cases.  
  

